# 통합 플랫폼 인증 관리 가이드

## 📋 개요

Sweet Order 플랫폼의 통합 인증 시스템은 3-way 분리된 API 구조(User, Seller, Admin)에서 역할 기반 접근 제어를 제공합니다. 하나의 통합된 `@Auth` 데코레이터를 통해 모든 인증과 권한을 효율적으로 관리할 수 있습니다.

## 🎯 주요 특징

- **3-way API 분리**: User, Seller, Admin 역할별 독립적인 API
- **통합 인증 시스템**: JWT + Google OAuth + 휴대폰 인증
- **역할 기반 접근 제어**: USER, SELLER, ADMIN 역할 구분
- **하나의 데코레이터로 모든 인증/권한 처리**
- **Public 엔드포인트 지원**
- **Swagger 자동 인증 헤더 표시**
- **계정 연결 시스템**: 일반 + 구글 계정 자동 연결

## ⭐ 권장 사용법

- **`@Auth({ isPublic: true })`**: 인증 없이 접근 가능한 엔드포인트
- **`@Auth({ isPublic: false })`**: 기본 인증 (모든 인증된 사용자)
- **`@Auth({ isPublic: false, roles: ['USER'] })`**: USER 역할만 접근 가능
- **`@Auth({ isPublic: false, roles: ['SELLER'] })`**: SELLER 역할만 접근 가능
- **`@Auth({ isPublic: false, roles: ['ADMIN'] })`**: ADMIN 역할만 접근 가능
- **`@Auth({ isPublic: false, roles: ['SELLER', 'ADMIN'] })`**: SELLER와 ADMIN 역할만 접근 가능

## 🔧 사용법

### 1. 기본 사용법

```typescript
import { Auth } from "@apps/backend/modules/auth/decorators/auth.decorator";

@Controller("example")
export class ExampleController {
  // 인증 없이 접근 가능
  @Get("public")
  @Auth({ isPublic: true })
  async getPublicData() {
    return { message: "공개 데이터" };
  }

  // 모든 인증된 사용자 접근 가능
  @Get("authenticated")
  @Auth({ isPublic: false })
  async getAuthenticatedData(@Request() req: { user: JwtVerifiedPayload }) {
    return { message: "인증된 사용자 데이터", user: req.user };
  }

  // USER 역할만 접근 가능
  @Get("user-only")
  @Auth({ isPublic: false, roles: ["USER"] })
  async getUserData(@Request() req: { user: JwtVerifiedPayload }) {
    return { message: "사용자 전용 데이터", user: req.user };
  }

  // SELLER 역할만 접근 가능
  @Get("seller-only")
  @Auth({ isPublic: false, roles: ["SELLER"] })
  async getSellerData(@Request() req: { user: JwtVerifiedPayload }) {
    return { message: "판매자 전용 데이터", user: req.user };
  }

  // ADMIN 역할만 접근 가능
  @Get("admin-only")
  @Auth({ isPublic: false, roles: ["ADMIN"] })
  async getAdminData(@Request() req: { user: JwtVerifiedPayload }) {
    return { message: "관리자 전용 데이터", user: req.user };
  }

  // SELLER와 ADMIN 역할만 접근 가능
  @Get("seller-or-admin")
  @Auth({ isPublic: false, roles: ["SELLER", "ADMIN"] })
  async getSellerOrAdminData(@Request() req: { user: JwtVerifiedPayload }) {
    return { message: "판매자/관리자 데이터", user: req.user };
  }
}
```

## 🎯 장점

1. **코드 간소화**: 하나의 데코레이터로 모든 인증/권한 처리
2. **가독성 향상**: 역할별 접근 제어가 명확하게 표현됨
3. **유지보수성**: 인증 로직이 중앙 집중화됨
4. **확장성**: 새로운 역할이나 권한 추가가 용이함
5. **일관성**: 모든 컨트롤러에서 동일한 패턴 사용

## 📚 참고사항

- 모든 데코레이터는 `@apps/backend/modules/auth/decorators/auth.decorator`에서 import
- `JwtVerifiedPayload` 타입을 사용하여 사용자 정보 접근
- Swagger 문서에서 자동으로 인증 헤더가 표시됨
- Public 엔드포인트는 인증 없이 접근 가능
- `@Auth()` 인자 없이 사용할 수 없음 - `isPublic` 필수 입력
